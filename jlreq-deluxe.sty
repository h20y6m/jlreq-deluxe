%%
%% jlreq-deluxe.sty
%%
%% Copyright 2019-2020 h20y6m
%%   GitHub:   https://github.com/h20y6m
%%
%% This package is distributed under the MIT License.
%%

% --------------------------------------------------

\NeedsTeXFormat{pLaTeX2e}
\RequirePackage{expl3}
\ProvidesExplPackage {jlreq-deluxe} {2020/03/15} {0.2.0}
  {Multi weight font for jlreq class}

% --------------------------------------------------
% load packeges

\RequirePackage{l3keys2e}

% --------------------------------------------------
% Variables

\tl_new:N \l__jldx_prefix_tl
\tl_new:N \l__jldx_scale_tl
\bool_new:N \l__jldx_hanging_punctuation_bool
\bool_new:N \l__jldx_zenkakunibu_nibu_bool
\bool_new:N \l__jldx_deluxe_bool

\bool_set_true:N \l__jldx_deluxe_bool

% --------------------------------------------------
% Messages

\msg_new:nnn { jlreq-deluxe } { option-not-available }
  { The~`#1'~option~is~not~available. }

% --------------------------------------------------
% Helpers

\prg_set_conditional:Npnn \__jldx_if_class_loaded:n #1 { p , T , F , TF }
  {
    \@ifclassloaded {#1}
      { \prg_return_true: }
      { \prg_return_false: }
  }

% --------------------------------------------------
%% Options

\keys_define:nn { jlreq-deluxe }
  {
    deluxe .bool_set:N = \l__jldx_deluxe_bool
  }

\keys_define:nn { jlreq-deluxe }
  {
    expert .code:n =
      {
        \msg_error:nnn { jlreq-deluxe } { option-not-available }
          { expert }
      }
  }

\keys_define:nn { jlreq-deluxe }
  {
    burasage .code:n =
      {
        \msg_error:nnn { jlreq-deluxe } { option-not-available }
          { burasage }
      }
  }

\keys_define:nn { jlreq-deluxe }
  {
    scale .tl_set:N = \l__jldx_scale_tl
  }

\keys_define:nn { jlreq-deluxe }
  {
    hanging_punctuation .bool_set:N = \l__jldx_hanging_punctuation_bool
  }

\keys_define:nn { jlreq-deluxe }
  {
    zenkakunibu_nibu .bool_set:N = \l__jldx_zenkakunibu_nibu_bool
  }

\keys_define:nn { jlreq-deluxe }
  {
    unknown .code:n =
      {
        \PassOptionsToPackage { \CurrentOption } { pxjodel }
      }
  }

\ProcessKeysOptions { jlreq-deluxe }

% --------------------------------------------------
%% jlreq parameters

\__jldx_if_class_loaded:nT { jlreq }
  {
    \jlreq@divide { \jlreq@jafontsize } { \jlreq@fontsize }
    \tl_set:Nx \l__jldx_scale_tl
      {
        \strip@pt \jlreq@resultdimen
      }
    \bool_set:Nn \l__jldx_zenkakunibu_nibu_bool
      {
        \str_if_eq_p:no { zenkakunibu_nibu } { \jlreq@open@bracket@pos }
      }
    \bool_set:Nn \l__jldx_hanging_punctuation_bool
      {
        \legacy_if_p:n { jlreq@burasage }
      }
  }

% --------------------------------------------------
%% prefix

\tl_set:Nn \l__jldx_prefix_tl { jlreq }

% zenkakunibu_nibu
\bool_if:NT \l__jldx_zenkakunibu_nibu_bool
  {
    \tl_put_left:Nn \l__jldx_prefix_tl { z }
  }
% hanging_punctuation
\bool_if:NT \l__jldx_hanging_punctuation_bool
  {
    \tl_put_left:Nn \l__jldx_prefix_tl { b }
  }

% --------------------------------------------------
% pxjodel

% jlreq jafont scale
\PassOptionsToPackage { prefix = \l__jldx_prefix_tl } { pxjodel }

% jlreq jafont scale
\tl_if_empty:NF \l__jldx_scale_tl
  {
    \PassOptionsToPackage { scale = \l__jldx_scale_tl } { pxjodel }
  }

% deluxe
\bool_if:NT \l__jldx_deluxe_bool
  {
    \PassOptionsToPackage { deluxe } { pxjodel }
  }

% load pxjodel package
\RequirePackage{pxjodel}
